<div id="alertBox"></div>

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <h4>üè¢ Company Master</h4>
    <button class="btn btn-primary" onclick="openAddModal()">
        <i class="bi bi-plus-lg"></i> Add New Company
    </button>
</div>

<!-- Search & Filter -->
<div class="row mb-3">
    <div class="col-md-4">
        <input type="text" id="search" class="form-control" placeholder="üîç Search company name, code, email..." value="<%= typeof search !== 'undefined' ? search : '' %>">
    </div>
    <div class="col-md-3">
        <select id="statusFilter" class="form-select">
            <option value="">All Status</option>
            <option value="1" <%= typeof is_active !== 'undefined' && is_active == '1' ? 'selected' : '' %>>Active</option>
            <option value="0" <%= typeof is_active !== 'undefined' && is_active == '0' ? 'selected' : '' %>>Inactive</option>
        </select>
    </div>
    <div class="col-md-3">
        <button class="btn btn-outline-secondary" onclick="resetFilters()">Reset</button>
    </div>
</div>

<!-- Companies Table -->
<div class="card">
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th width="60">ID</th>
                    <th>Company Name</th>
                    <th>Code</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th width="80">Currency</th>
                    <th width="80">Status</th>
                    <th width="180">Actions</th>
                </tr>
            </thead>
            <tbody id="companyTable">
                <!-- Data loaded via JS -->
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
<nav class="mt-3">
    <ul class="pagination" id="pagination"></ul>
</nav>

<!-- Add/Edit Modal -->
<div class="modal fade" id="companyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Company</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="companyForm">
                    <input type="hidden" id="company_id">
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company Name <span class="text-danger">*</span></label>
                            <input type="text" id="company_name" class="form-control" placeholder="Enter company name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company Code <span class="text-danger">*</span></label>
                            <input type="text" id="company_code" class="form-control" placeholder="e.g. RAMZANS" style="text-transform: uppercase" required>
                            <small class="text-muted">Unique identifier for the company</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" id="email" class="form-control" placeholder="company@example.com">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" id="phone" class="form-control" placeholder="+44 1234 567890">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Currency Code</label>
                            <input type="text" id="currency_code" class="form-control" placeholder="GBP" value="GBP">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Currency Symbol</label>
                            <input type="text" id="currency_symbol" class="form-control" placeholder="¬£" value="¬£">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Tax Percentage (%)</label>
                            <input type="number" id="tax_percentage" class="form-control" placeholder="0.00" value="0" step="0.01" min="0" max="100">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea id="address" class="form-control" rows="2" placeholder="Enter company address"></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Logo URL</label>
                        <input type="text" id="logo_url" class="form-control" placeholder="https://example.com/logo.png">
                    </div>

                    <div class="mb-3" id="statusField" style="display: none;">
                        <label class="form-label">Status</label>
                        <select id="is_active" class="form-select">
                            <option value="1">Active</option>
                            <option value="0">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="saveBtn" onclick="saveCompany(this)">
                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                    Save
                </button>
            </div>
        </div>
    </div>
</div>

<!-- View Modal -->
<div class="modal fade" id="viewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Company Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="viewContent">
                <!-- Content loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-warning" id="editFromViewBtn">Edit</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">‚ö†Ô∏è Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this company?</p>
                <p class="mb-0"><strong id="deleteCompanyName"></strong></p>
                <input type="hidden" id="deleteCompanyId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="deleteCompanyConfirm()">Delete</button>
            </div>
        </div>
    </div>
</div>
<script>
    const API_URL = '/api/companies';
    // Modal instances
    let companyModal;
    let viewModal;
    let deleteModal;

    // Current state
    let currentPage = 1;
    let currentCompanyData = null;
</script>
<%- scripts = '<script src="/js/company.js"></script>' %>

